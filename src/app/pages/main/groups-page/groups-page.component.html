<div class="main">
  <div class="side-block">
    <div style="margin-bottom: 10px;">
      <button *ngIf="sideBlockStatus === 1" nz-button [nzType]="'primary'" (click)="openAddGroup()">建团</button>
      <button *ngIf="sideBlockStatus === 2" nz-button [nzType]="'primary'" (click)="cancelAddGroup()">取消</button>
      <button *ngIf="sideBlockStatus === 3" nz-button [nzType]="'primary'" (click)="exitGroup()">返回</button>

      <button *ngIf="sideBlockStatus === 2" nz-button [nzType]="'primary'"
              style="float: right;" (click)="addGroup()">保存
      </button>
    </div>

    <div *ngIf="sideBlockStatus === 2">
      <form nz-form [formGroup]="groupAddForm" (ngSubmit)="addGroup()">
        <div nz-form-item>
          <div nz-form-control [nzValidateStatus]="groupAddForm.get('groupName')">
            <nz-input formControlName="groupName" [nzPlaceHolder]="'团组名称'" [nzSize]="'large'">
            </nz-input>
          </div>
        </div>
        <div nz-form-item>
          <div nz-form-control [nzValidateStatus]="groupAddForm.get('dueTime')">
            <nz-datepicker style="width: 100%;" [nzSize]="'large'" formControlName="dueTime" [nzShowTime]="true"
                           [nzPlaceHolder]="'选择截止日期'" [nzFormat]="'YYYY-MM-DD HH:mm:ss'"></nz-datepicker>
          </div>
        </div>
      </form>
    </div>

    <div *ngIf="sideBlockStatus !== 2">
      <ng-template ngFor let-group [ngForOf]="groups">
        <div class="group-item"
             [class.item-hover]="sideBlockStatus === 1"
             *ngIf="sideBlockStatus === 1 || group.id === groupId"
             (click)="selectGroup(group.id)">
          <div class="group-item-info">
            <div class="group-item-info-line">
              <nz-avatar nzSize="small" nzIcon="user" [nzSrc]="group.composer_img || ''"></nz-avatar>
              <span style="margin-left: 10px;">{{group.name}}</span>
            </div>
            <div class="group-item-info-line">
              <nz-tag [nzColor]="'orange'">征集中</nz-tag>
              <span>{{formatRemainTime(group.remainTime)}}</span>
            </div>
          </div>
          <div class="group-item-arrow" *ngIf="sideBlockStatus === 1">
            <i class="anticon anticon-right"></i>
          </div>
        </div>
      </ng-template>
    </div>

    <div *ngIf="sideBlockStatus === 3">
      <ng-template ngFor let-order [ngForOf]="orders">
        <div class="order-item">
          <div class="order-item-user-line">
            <nz-avatar nzSize="small" nzIcon="user" [nzSrc]="order.user?.avatar_url || ''"></nz-avatar>
            <span style="margin-left: 10px;flex: 1;">{{order.user.username || order.user.nickname}}</span>
            <span class="price">￥{{order.totalPrice}}</span>
          </div>
          <div class="order-item-line" *ngFor="let row of order.rows">
            <a (click)="removeOrder(row.id)">
              <i class="anticon anticon-close"></i>
            </a>
            <span style="margin-left: 10px;flex: 1;">{{row.product_name}}</span>
            <span style="width: 60px;text-align: right;">{{row.quantity}}</span>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="product-block">
    <nz-table #nzTable [nzAjaxData]="products" [nzPageSize]="15"
              nzSize="small" [nzShowTotal]="true" [nzTotal]="total"
              [(nzPageIndex)]="page" (nzPageIndexChange)="listTodayProduct('refresh')"
              [nzLoading]="tableLoading">
      <thead nz-thead>
      <tr>
        <th nz-th nzWidth="10%">#</th>
        <th nz-th nzWidth="30%"><span>菜单名</span></th>
        <th nz-th nzWidth="20%">
          <span>类别</span>
          <nz-dropdown>
            <i class="anticon anticon-filter" nz-dropdown
               [style.color]="condition.category ? 'red' : ''"></i>
            <ul nz-menu>
              <li nz-menu-item *ngFor="let option of categoryOptions"
                  (click)="condition.category = option;listTodayProduct('reload')">
                <span>{{option}}</span>
              </li>
            </ul>
            <div nz-table-filter>
              <span nz-table-filter-clear (click)="condition.category = '';listTodayProduct('reload')">重置</span>
            </div>
          </nz-dropdown>
        </th>
        <th nz-th nzWidth="20%"><span>价格</span></th>
        <th nz-th nzWidth="20%"><span>操作</span></th>
      </tr>
      </thead>
      <tbody nz-tbody>
      <tr nz-tbody-tr *ngFor="let data of nzTable.data; let i = index;"
          [class.invalid-product]="!data.valid">
        <td nz-td nzWidth="10%">{{i+1}}</td>
        <td nz-td nzWidth="30%">{{data.name}}</td>
        <td nz-td nzWidth="20%">{{data.category}}</td>
        <td nz-td nzWidth="20%">{{data.price}}</td>
        <td nz-td nzWidth="20%">
          <a (click)="addOrder(data)">点餐</a>
        </td>
      </tr>
      </tbody>
    </nz-table>
  </div>
</div>
